/* less2css - v0.0.5 - http://less2css.org/
 * Copyright (c) 2013 Brian Frichette. All rights reserved.
 * Licensed MIT - http://opensource.org/licenses/MIT
 */
jQuery(function($){var OptionsDrawer=function(){function OptionsDrawer(){this.els={lessOptions:$("#less-options"),optsDrawer:$("#options-drawer"),optsWrap:$("#options-drawer-wrap"),optsBtn:$("#options-button"),optsLnk:$("#options-link"),nav:$("#nav")},this.fx={duration:300},this.text={optsOpen:"Close",optsDefault:"Options"},this.isOpen=!1,this.closeDrawer(!0),this.setupEvents()}return OptionsDrawer.name="OptionsDrawer",OptionsDrawer.prototype={setupEvents:function(){var t=this,e=t.els;e.optsBtn.on("click",function(e){e.preventDefault(),t.isOpen?t.closeDrawer.call(t):t.openDrawer.call(t)}),e.optsLnk.on("click",function(t){t.preventDefault(),e.optsBtn.trigger("click")})},openDrawer:function(){var t={top:this.els.nav.height(),opacity:1},e={duration:this.fx.duration};this.els.lessOptions.addClass("open"),this.detach(),this.animateDrawer("open",t,e)},closeDrawer:function(t){var e=this.els,s={top:-this.getDrawerTop(),opacity:0},n={duration:t?0:this.fx.duration};e.lessOptions.removeClass("open"),n.complete=t?function(){e.optsDrawer.fadeIn()}:void 0,this.animateDrawer("close",s,n)},animateDrawer:function(t,e,s){var n=this,o=this.els.optsDrawer,i=new $.Deferred,r=s.complete||function(){};s.complete=function(){return i.resolve(),r.apply(n,arguments)},o.animate(e,s),i.done(function(){"close"===t?n.onClose.call(n):n.onOpen.call(n)})},getDrawerTop:function(){return this.els.optsDrawer.outerHeight()-this.els.nav.height()},getBtnLeft:function(){var t=this.els.optsBtn[0];return t.parentElement.offsetLeft+t.parentElement.parentElement.offsetLeft},attach:function(){this.els.optsBtn.insertAfter(this.els.optsLnk),this.els.optsBtn.removeClass("active")[0].style.cssText=""},detach:function(){var t=this.els,e=t.optsBtn,s=e.width(),n=this.getBtnLeft();t.optsBtn.css({left:n,width:s}).addClass("active"),this.els.optsBtn.appendTo(this.els.optsWrap)},onOpen:function(){this.isOpen=!0},onClose:function(){this.attach(),this.isOpen=!1}},OptionsDrawer}();return new OptionsDrawer}),l2c=angular.module("Less2Css",[]),l2c.run(["$rootScope",function(t){t.safeApply=function(t){var e=this.$root.$$phase,t=t||function(){};"$digest"===e||"$apply"===e?t():this.$apply(t)}}]),l2c.factory("Stor",["$q","$rootScope","$timeout",function(t,e,s){var Stor=function(){function Stor(t,e){this.key=null!=t?t:void 0,this.exp=null!=e?e:null,this.amp=amplify.store}return Stor.name="Stor",Stor.prototype={get:function(t){return null==t&&(t=this.key),this.amp(t)},set:function(t,e,s){return null==e&&(e=this.key),null==s&&(s=this.exp),this.amp(e,t,{expires:s})},remove:function(t){null==t&&(t=this.key),this.amp(t,null)},empty:function(){var t=this.amp();for(var e in t)this.amp(e,null)},getAsync:function(){var n=arguments[0],o=[].slice.call(arguments,1),i=t.defer(),r=this;return s(function(){var t=r.get.apply(r,o);if(t)e.safeApply(e,function(){i.resolve({data:t,type:"local"})});else{var s=n(),a={type:"xhr"};s.then(function(t){return e.safeApply(e,function(){a.data=t.data,a.status=t.status,i.resolve(a)})})}},1),i.promise}},Stor}();return Stor}]),l2c.factory("LessCompiler",["$http","Stor",function(t,Stor){var e=new Stor("LessCache"),s=function(){function t(){this.options={saveLess:!0,lessPath:"/javascripts/less/less-{version}.js"},this.defaults=_.cloneDeep(this.options),this.storage=e}return t.name="LessCompiler",t.prototype={initLess:function(){this.parser=new less.Parser(this.lessOptions)},loadLess:function(){window.less=void 0;var t=this.options,e=this.lessOptions,s=e.lessVersion;s=s===e.preRelease?s+"-beta":s;var n=t.lessPath.replace("{version}",s);return $.ajax({url:n,cache:!0,dataType:"script"})},compileLess:function(t){try{var e=this.parseLess(t,this.lessOptions);return this.error=!1,e}catch(s){return this.error=!0,this.updateError(s)}},parseLess:function(t){var e=this.lessOptions,s="";return this.parser.parse(t,function(t,n){if(t)throw t;s=n.toCSS(e)}),s},updateOptions:function(t){this.lessOptions=t,window.less&&this.initLess()},updateError:function(t){var e=t.type+" error: "+t.message+"\n"+(t.extract&&t.extract.join&&t.extract.join(""));return e}},t}();return new s}]),l2c.directive("fadeShow",function(){function t(t,e,s){function n(t,e){null==e&&(e=!1),t?o.fadeIn(r):e?o.hide():o.fadeOut(r)}var o=$(e),i=s.fadeShow,r=400;n(t.$eval(i),!0),t.$watch(function(){return t.$eval(i)},function(t){n(t)})}return t}),l2c.directive("lessEditor",function(){return{restrict:"A",require:"ngModel",link:function(t,e,s,n){function o(){var o=t[s.opts],r=CodeMirror.fromTextArea(e[0],o);r.on("change",i(o.onChange)),n.$render=function(){r.setValue(n.$viewValue)}}function i(){return function(e){var s=e.getValue();s!==n.$viewValue&&(n.$setViewValue(s),t.$apply())}}t.$on("optionsLoaded",o)}}}),l2c.controller("Less2CssCtrl",["$http","$scope","Stor","LessCompiler",function(t,e,Stor,s){function n(){e.loading=!0;var t=s.loadLess();t.done(function(){e.$apply(function(){s.initLess(),o(),e.loading=!1})})}function o(){e.cssOutput=s.compileLess(e.lessInput),e.compileError=s.error,e.safeApply()}function i(t){for(var s in t)e[s]=t[s]}function r(t){_.each(t.lessVersions,function(t){"current"===t.type&&(e.lessOptions.lessVersion=t.number),"pre"===t.type&&(e.lessOptions.preRelease=t.number)}),e.dumpLineNumbers=function(){var e=_.find(t.lineNumberOptions,function(t){return!!t["default"]});return e.value}()}var a=t.get("/less-options"),l=new Stor("LessCache");a.success(function(t){i(t),r(t),e.$emit("optionsLoaded"),e.updateOptions(),n()}),a.success(function(){e.$watch("lessInput",function(t){l.set(t),o()}),e.$watch("lessOptions",function(){o()},!0),e.$watch("lessOptions.lessVersion",function(){n()})}),e.lessInput=l.get()||$("#less-input").val(),e.cssOutput="",e.rootpath="",e.loading=!1,e.legacyUnits=!1,e.compileError=!1,e.updateOptions=function(){var t=e.lessOptions;t.dumpLineNumbers=e.lineNumbersEnabled?e.dumpLineNumbers:!1,t.rootpath=e.rootPathEnabled?e.rootpath:"",e.legacyUnits=!e.isLegacy()&&e.legacyUnits?!0:!1,t.strictMaths=t.strictUnits=e.legacyUnits?!1:!0,s.updateOptions(t)},e.toggleModel=function(t){e[t]=!e[t],e.updateOptions()},e.toggleTxt=function(t){return e[t]?"Enabled":"Disabled"},e.isLegacy=function(){return e.lessOptions?1.4>parseFloat(e.lessOptions.lessVersion,10):!1}}]);