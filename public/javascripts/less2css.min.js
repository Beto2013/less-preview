/* less2css - v0.0.5 - http://less2css.org/
 * Copyright (c) 2013 Brian Frichette. All rights reserved.
 * Licensed MIT - http://opensource.org/licenses/MIT
 */
jQuery(function($){var OptionsDrawer=function(){function OptionsDrawer(){this.els={nav:$("#nav"),optsLnk:$("#options-link"),optsBtn:$("#options-button"),optsWrap:$("#options-drawer-wrap"),optsDrawer:$("#options-drawer"),lessOptions:$("#less-options")},this.fx={duration:300},this.text={optsOpen:"Close",optsDefault:"Options"},this.isOpen=!1,this.closeDrawer(!0),this.setupEvents()}return OptionsDrawer.name="OptionsDrawer",OptionsDrawer.prototype={setupEvents:function(){var a=this,b=a.els;b.optsBtn.on("click",function(b){b.preventDefault(),a.isOpen?a.closeDrawer.call(a):a.openDrawer.call(a)}),b.optsLnk.on("click",function(a){a.preventDefault(),b.optsBtn.trigger("click")})},openDrawer:function(){var a={top:this.els.nav.height(),opacity:1},b={duration:this.fx.duration};this.els.lessOptions.addClass("open"),this.detach(),this.animateDrawer("open",a,b)},closeDrawer:function(a){var b=this.els,c={top:-this.getDrawerTop(),opacity:0},d={duration:a?0:this.fx.duration};b.lessOptions.removeClass("open"),d.complete=a?function(){b.optsDrawer.fadeIn()}:void 0,this.animateDrawer("close",c,d)},animateDrawer:function(a,b,c){var d=this,e=this.els.optsDrawer,f=new $.Deferred,g=c.complete||function(){};c.complete=function(){return f.resolve(),g.apply(d,arguments)},e.animate(b,c),f.done(function(){"close"===a?d.onClose.call(d):d.onOpen.call(d)})},getDrawerTop:function(){return this.els.optsDrawer.outerHeight()-this.els.nav.height()},getBtnLeft:function(){var a=this.els.optsBtn[0];return a.parentElement.offsetLeft+a.parentElement.parentElement.offsetLeft},attach:function(){this.els.optsBtn.insertAfter(this.els.optsLnk),this.els.optsBtn.removeClass("active")[0].style.cssText=""},detach:function(){var a=this.els,b=a.optsBtn,c=b.width(),d=this.getBtnLeft();a.optsBtn.css({left:d,width:c}).addClass("active"),this.els.optsBtn.appendTo(this.els.optsWrap)},onOpen:function(){this.isOpen=!0},onClose:function(){this.attach(),this.isOpen=!1}},OptionsDrawer}();return new OptionsDrawer}),l2c=angular.module("Less2Css",[]),l2c.run(["$rootScope",function(a){a.safeApply=function(a){var b=this.$root.$$phase,a=a||function(){};"$digest"===b||"$apply"===b?a():this.$apply(a)}}]),l2c.factory("Stor",["$q","$rootScope","$timeout",function(a,b,c){var Stor=function(){function Stor(a,b){this.key=null!=a?a:void 0,this.exp=null!=b?b:null,this.amp=amplify.store}return Stor.name="Stor",Stor.prototype={get:function(a){return null==a&&(a=this.key),this.amp(a)},set:function(a,b,c){return null==b&&(b=this.key),null==c&&(c=this.exp),this.amp(b,a,{expires:c})},remove:function(a){null==a&&(a=this.key),this.amp(a,null)},empty:function(){var a=this.amp();for(var b in a)this.amp(b,null)},getAsync:function(){var d=arguments[0],e=[].slice.call(arguments,1),f=a.defer(),g=this;return c(function(){var a=g.get.apply(g,e);if(a)b.safeApply(b,function(){f.resolve({data:a,type:"local"})});else{var c=d(),h={type:"xhr"};c.then(function(a){return b.safeApply(b,function(){h.data=a.data,h.status=a.status,f.resolve(h)})})}},1),f.promise}},Stor}();return Stor}]),l2c.factory("LessCompiler",["$http","Stor",function(a,Stor){var b=new Stor("LessCache"),c=function(){function a(){this.options={saveLess:!0,lessPath:"/javascripts/less/less-{version}.js"},this.defaults=_.cloneDeep(this.options),this.storage=b}return a.name="LessCompiler",a.prototype={initLess:function(){this.parser=new less.Parser(this.lessOptions)},loadLess:function(){window.less=void 0;var a=this.options,b=this.lessOptions,c=b.lessVersion;c=c===b.preRelease?c+"-beta":c;var d=a.lessPath.replace("{version}",c);return $.ajax({url:d,cache:!0,dataType:"script"})},compileLess:function(a){try{var b=this.parseLess(a,this.lessOptions);return this.error=!1,b}catch(c){return this.error=!0,this.updateError(c)}},parseLess:function(a){var b=this.lessOptions,c="";return this.parser.parse(a,function(a,d){if(a)throw a;c=d.toCSS(b)}),c},updateOptions:function(a){this.lessOptions=a,window.less&&this.initLess()},updateError:function(a){var b=a.type+" error: "+a.message+"\n"+(a.extract&&a.extract.join&&a.extract.join(""));return b}},a}();return new c}]),l2c.directive("fadeShow",function(){function a(a,b,c){function d(a,b){null==b&&(b=!1),a?e.fadeIn(g):b?e.hide():e.fadeOut(g)}var e=$(b),f=c.fadeShow,g=400;d(a.$eval(f),!0),a.$watch(function(){return a.$eval(f)},function(a){d(a)})}return a}),l2c.directive("lessEditor",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(){var e=a[c.opts],g=CodeMirror.fromTextArea(b[0],e);g.on("change",f(e.onChange)),d.$render=function(){g.setValue(d.$viewValue)}}function f(){return function(b){var c=b.getValue();c!==d.$viewValue&&(d.$setViewValue(c),a.$apply())}}a.$on("optionsLoaded",e)}}}),l2c.controller("Less2CssCtrl",["$http","$scope","Stor","LessCompiler",function(a,b,Stor,c){function d(){b.loading=!0;var a=c.loadLess();a.done(function(){b.$apply(function(){c.initLess(),e(),b.loading=!1})})}function e(){b.cssOutput=c.compileLess(b.lessInput),b.compileError=c.error,b.safeApply()}function f(a){for(var c in a)b[c]=a[c]}function g(a){_.each(a.lessVersions,function(a){"current"===a.type&&(b.lessOptions.lessVersion=a.number),"pre"===a.type&&(b.lessOptions.preRelease=a.number)}),b.dumpLineNumbers=function(){var b=_.find(a.lineNumberOptions,function(a){return!!a["default"]});return b.value}()}var h=a.get("/less-options"),i=new Stor("LessCache");h.success(function(a){f(a),g(a),b.$emit("optionsLoaded"),b.updateOptions(),d()}),h.success(function(){b.$watch("lessInput",function(a){i.set(a),e()}),b.$watch("lessOptions",function(){e()},!0),b.$watch("lessOptions.lessVersion",function(){d()})}),b.lessInput=i.get()||$("#less-input").val(),b.cssOutput="",b.rootpath="",b.loading=!1,b.legacyUnits=!1,b.compileError=!1,b.updateOptions=function(){var a=b.lessOptions;a.dumpLineNumbers=b.lineNumbersEnabled?b.dumpLineNumbers:!1,a.rootpath=b.rootPathEnabled?b.rootpath:"",b.legacyUnits=!b.isLegacy()&&b.legacyUnits?!0:!1,a.strictMaths=a.strictUnits=b.legacyUnits?!1:!0,c.updateOptions(a)},b.toggleModel=function(a){b[a]=!b[a],b.updateOptions()},b.toggleTxt=function(a){return b[a]?"Enabled":"Disabled"},b.isLegacy=function(){return b.lessOptions?parseFloat(b.lessOptions.lessVersion,10)<1.4:!1}}]);